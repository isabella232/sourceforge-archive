<!--
========================================================================
 Copyright (c) 1999 Mort Bay Consulting (Australia) Pty. Ltd.
 $Id$
========================================================================

targets:

clean       - Remove all generated files.
tidy        - Remove unneeded generated files.
prepare     - Set up build directory structure.
classes     - compile the classes
jmx.jar     - Builds the jmx jar.
demo        - Runs the demo web application.
all         - everything

-->
<project name="Jetty JMX" default="all" basedir=".">

  <property environment="env"/>

  <property name="src"            value="${basedir}/src" />
  <property name="lib"            value="${basedir}/lib"/>
  <property name="etc"            value="${basedir}/etc"/>
  <property name="classes"        value="${basedir}/classes"/>
  <property name="javadoc"        value="${basedir}/javadoc"/>
  <property name="logs"           value="${basedir}/logs"/>

  <property name="build.compiler" value="jikes"/>
  <!-- property name="build.compiler" value="classic"/ -->
  <!-- property name="build.compiler" value="modem"/ -->

  <property name="jetty"          value="${env.JETTY_HOME}"/>
  <property name="jetty.lib"      value="${jetty}/lib"/>

  <property name="mortbay.jmx.jar"  value="${lib}/org.mortbay.jmx.jar"/>

  <property name="jetty.jar"      value="${jetty.lib}/org.mortbay.jetty.jar"/>
  <property name="servlet.jar"    value="${jetty.lib}/javax.servlet.jar"/>
  <property name="jasper.jar"     value="${jetty.lib}/org.apache.jasper.jar"/>
  <property name="jaxp.jar"       value="${jetty.lib}/javax.xml.jaxp.jar"/>
  <property name="xml.jar"        value="${jetty.lib}/org.apache.crimson.jar"/>
  <property name="jsse.jar"       value="${jetty.lib}/com.sun.net.ssl.jar"/>

  <property name="jmxri.jar"      value="${lib}/jmxri.jar"/>
  <property name="jmxtools.jar"   value="${lib}/jmxtools.jar"/>

  <property name="classpath"      value="${jasper.jar};${jetty.jar};${xml.jar};${jaxp.jar};${jsse.jar};${servlet.jar};${jmxri.jar};${jmxtools.jar}"/>

  <target name="prepare">
    <mkdir dir="${javadoc}" />
    <mkdir dir="${classes}" />
    <copy  file="${src}/org/mortbay/jetty/jmx/jetty.mlet" tofile="${etc}/jetty.mlet" />
  </target>

  <target name="tidy" >
    <delete dir="${classes}"/>
  </target>

  <target name="clean" depends="tidy">
    <delete dir="${javadoc}"/>
    <delete file="${mortbay.jmx.jar}"/>
  </target>

  <target name="classes" depends="prepare">
    <copy todir="${classes}" >
      <fileset dir="${src}">
        <include name="**/defaultManifest.mf" />
        <include name="**/*.properties" />
        <include name="**/*.dtd" />
      </fileset>
    </copy>
    <javac srcdir="${src}"
           destdir="${classes}"
           classpath="${classpath}"
           debug="off"
           optimize="off"
           deprecation="off"
           >
       <include name="**/*.java"/>
    </javac>
  </target>

  <target name="jmx.jar" depends="classes">
    <jar jarfile="${mortbay.jmx.jar}" basedir="${classes}" >
       <include name="org/mortbay/**/jmx/**"  />
       <exclude name="org/mortbay/**/Test*.class" />
    </jar>
  </target>

  <target name="javadoc" depends="jmx.jar">
    <javadoc packagenames="org.mortbay.*"
             sourcepath="${src}"
             classpath="${classpath}:${mortbay.jmx.jar}"
             destdir="${javadoc}"
             author="true"
             version="true"
             public="true"
             windowtitle="${ant.project.name}"
             doctitle="${ant.project.name}"
             bottom="Copyright &#169; 2001 Mortbay Consulting Pty. Ltd. All Rights Reserved.">
    </javadoc>
  </target>

  <target name="test" depends="jmx.jar" >
    <copy file="${src}/org/mortbay/util/jmx/test.mlet" tofile="${etc}/test.mlet" />
    <replace file="${etc}/test.mlet" token="__JETTY_JMX_HOME__" value="${basedir}" />
    <touch file="${etc}/test.mlet" datetime="01/01/2000 12:00 am"/>
    <java classname="org.mortbay.util.jmx.Main"
          classpath="${mortbay.jmx.jar}:${classpath}:${classes}"
          fork="yes"
          failonerror="yes"
          >
       <arg line="${etc}/test.mlet" />
    </java>
  </target>


  <target name="demo" depends="jmx.jar" >
    <copy file="${src}/org/mortbay/jetty/jmx/jetty.mlet" tofile="${etc}/jetty.mlet" />
    <replace file="${etc}/jetty.mlet" token="__JETTY_JMX_HOME__" value="${basedir}" />
    <replace file="${etc}/jetty.mlet" token="__JETTY_HOME__" value="${jetty}" />
    <touch file="${etc}/jetty.mlet" datetime="01/01/2000 12:00 am"/>
    <java classname="org.mortbay.util.jmx.Main"
          classpath="${mortbay.jmx.jar}:${classpath}"
          fork="yes"
          failonerror="yes"
          >
       <jvmarg line="-Djetty.home=${jetty} -Djetty.log=${jetty}/logs" />
       <arg line="${etc}/jetty.mlet" />
    </java>
  </target>


  <target name="all" depends="jmx.jar,javadoc"/>

</project>







