<BR><H1>HTTP Server Tutorial
&nbsp;&nbsp;&nbsp;&nbsp;<FONT size=-2>
<A href="overview.html">Back</A>
<A href="index.html">Index</A>
<A href="..">Exit</A>
<A href="Server.html">Next</A>
</FONT></H1>

The <a href="/javadoc/org/mortbay/http/HttpServer.html">org.mortbay.http.HttpServer</a> class provides a connection between a collection of request listeners and collections of request handlers:
<PRE>
  HttpListener --&gt; HttpServlet --&gt; HandlerContext --&gt; HttpHandler
</PRE>
A simple example of this to have single SocketListener listening for normal HTTP requests and a ResourceHandler serving static content:

<PRE>
  SocketListener --&gt; HttpServlet --&gt; HandlerContext --&gt; ResourceHandler
   port: 80                              "/"            "./docroot"
</PRE>

<FONT Size=+1><B>HTTP Listeners</B></FONT><BR>
Implementations of the <a href="/javadoc/org/mortbay/http/HttpListener.html">org.mortbay.http.HttpListener</a> interface are added to a HttpServer and act as sources of requests for the server.  <a href="/javadoc/org/mortbay/http/SocketListener.html">org.mortbay.http.SocketListener</a> is the main implementation that listens of a standard TCP/IP port for request, but there are also implementation for SSL, Non blocking IO, testing and others. 
<P>
Multiple listeners may be used to listen on different ports or specific IP addresses.  This is most frequently used for SSL or multi-hosting:

<PRE>
  SocketListener --&gt; HttpServlet --&gt; HandlerContext --&gt; ResourceHandler
   port: 80                              "/"            "./docroot"
  JSSEListener   --&gt; 
   port: 443                            
  SocketListener --&gt; 
   host: 1.2.3.4
   port: 80                              
</PRE>

Listeners are configured via set methods.  Listeners can be created by using the HttpServer as a factory to create a standard type of listener:
<PRE>
    HttpServer server = new HttpServer();
    HttpListener listener = 
        server.addListener(new InetAddrPort("myhost",8080));
</PRE>
However, in order to provide detailed configuration, it is more common to create 
the listener directly and then add it to the HttpServer:
<PRE>
    HttpServer server = new HttpServer();
    SocketListener listener = new SocketListener();
    listener.setHost("myhost");
    listener.setPort(8080);
    listener.setMinThreads(5);
    listener.setMaxThreads(250);
    server.addListener(listener);
</PRE>
Note that HttpListeners are responsible for allocating threads to requests, so most implementations are extensions of the 
<a href="/javadoc/org/mortbay/util/ThreadedServer.html">org.mortbay.util.ThreadedServer</a> or
<a href="/javadoc/org/mortbay/util/ThreadPool.html">org.mortbay.util.ThreadPool</a>.
Thus attributes such as min/max threads, min/max idle times etc are set via the listeners API.  As usual, the configurations above can also be express in XML:
<PRE>
  &lt;Call name="addListener"&gt;
    &lt;Arg&gt;
      &lt;New class="org.mortbay.http.SocketListener"&gt;
        &lt;Set name="Port"&gt;8080&lt;/Set&gt;
        &lt;Set name="MinThreads"&gt;5&lt;/Set&gt;
        &lt;Set name="MaxThreads"&gt;255&lt;/Set&gt;
      &lt;/New&gt;
    &lt;/Arg&gt;
  &lt;/Call&gt;
</PRE>



<P>
<FONT Size=+1><B>Handler Contexts</B></FONT><BR>

A <a href="/javadoc/org/mortbay/http/HandlerContext.html">org.mortbay.http.HandlerContext</a> is a collection of 
<a href="/javadoc/org/mortbay/http/HttpHandler.html">org.mortbay.http.HttpHandler</a> implementations, which are tried in turn until a request is handled.  Typically a context might have a security, servlet and resource handler:

<PRE>
  SocketListener --&gt; HttpServlet --&gt; HandlerContext --&gt; SecurityHandler
   port: 80                              "/"        --&gt; ServletHandler
                                                    --&gt; ResourceHandler
</PRE>

HttpHandlers within a HandlerContext share the following attributes:<UL>
<LI>Initialization parameters
<LI>An optional virtual host name for the context.
<LI>A path prefix for the context.
<LI>A resource base for loading static resources (files).
<LI>A ClassLoader and set of java Permissions.
<LI>A request log.
<LI>Statistics
<LI>Error page mappings.
<LI>MIME type suffix maps. 
</UL>

Multiple contexts are typically used to server several applications from the same port(s) using URL mappings:

<PRE>
  SocketListener --&gt; HttpServlet --&gt; HandlerContext --&gt; HttpHandler(s)
   port: 80                              path: /contextpath1/*
                                 --&gt; HandlerContext --&gt; HttpHandler(s)
                                         path: /contextpath2/*           
</PRE>

Or virtual hosts:


<PRE>
  SocketListener --&gt; HttpServlet --&gt; HandlerContext --&gt; HttpHandler(s)
   port: 80                              host: www.acme.com
                                         path: /
                                 --&gt; HandlerContext --&gt; HttpHandler(s)
                                         host: www.myacme.org
                                         path: /
</PRE>
If multiple contexts are to be served from the same port, but on different 
IP addresses, then each context may be given its own HttpServer:

<PRE>
  SocketListener --&gt; HttpServlet --&gt; HandlerContext --&gt; HttpHandler(s)
   host: www.acme.com                    path: /
   port: 80  
  SocketListener --&gt; HttpServlet --&gt; HandlerContext --&gt; HttpHandler(s)
   host: www.myacme.org                  path: /
   port: 80                              
</PRE>

The HttpServer is used as a factory to create HandlerContext instances
for a specific context path:
<PRE>
    HandlerContext context = server.addContext("/context/*");
    context.setResourceBase("./docroot/");
</PRE>
Or for a specific virtual host and context path:
<PRE>
    HandlerContext context = server.addContext("myhost","/context/*");
    context.setResourceBase("./docroot/");
</PRE>
A handler context may be registered with multiple virtual hosts, but only a single context path:
<PRE>
    HandlerContext context = server.addContext("myhost1","/context/*");
    context.setResourceBase("./docroot/");
    server.addContext("myhost2",context);
</PRE>
Virtual hosts may have several aliases registered:
<PRE>
    HandlerContext context = server.addContext("myhost","/context/*");
    server.addHostAlias("myhost","myhost.com");
    server.addHostAlias("myhost","www.myhost.com");
    server.addHostAlias("myhost","1.2.3.4");
</PRE>

Each call to <CODE>addContext()</CODE> will create new HandlerContext instance.  Multiple contexts can exist for the 
same contextPath and they are tried in the order they were added until the request is handled.   If you wish to avoid 
the possibility of creating multiple contexts, the <CODE>getContext</CODE> can be used to get an existing context or
to create one if one does not exist:
<PRE>
    HandlerContext context = server.getContext("myhost","/context/*");
    context.setResourceBase("./docroot/");
</PRE>

Derivations of HttpServer may implement the <Code>newHandlerContext()</Code> method to change the factory method for creating new Contexts.  This is used by the <a href="/javadoc/org/mortbay/jetty/Server.html">org.mortbay.jetty.Server</a> class to return 
HandlerContext derivations that have conveniance methods for configuring servlets.
The <a href="/javadoc/org/mortbay/jetty/server/WebApplicationContext.html">org.mortbay.jetty.servlet.WebApplicationContext</a> class is a specialization of HandlerContext that configures the handlers by looking at the standard web application files and layout.
<P>

<FONT Size=+1><B>HTTP Handlers</B></FONT><BR>
The <a href="/javadoc/org/mortbay/http/HttpHandler.html">org.mortbay.http.HttpHandler</a> interface represents Jetty's core unit of content generation or manipulation. Implementations of this interface can be used to modify or handle requests. Typically handlers are arranged in a list, and a request presented to each handler in turn until the one indicates that the request has been handled.  This allows handlers to:
<UL>
<LI>Ignore requests that are not applicable
<LI>Handler requests by populating the response and/or generating content
<LI>Modify the request but allow it to pass onto the next handler(s). 
Headers and attributes may be modified or an InputStream filter added.
<LI>Modify the response but allow the request to pass onto the next handler(s). 
Headers may be modified or OutputStream filters added.
</UL>
The handlers provided in the <A href="/javadoc/org/mortbay/http/handler/package-summary.html">org.mortbay.http.handler</A> package are:<UL>
<A href="/javadoc/org/mortbay/http/handler/NullHandler.html">NullHandler</A> - An abstract base implementation of the interface.
<BR><A href="/javadoc/org/mortbay/http/handler/ResourceHandler.html">ResourceHandler</A> - Serve static content from the resource base of the HandlerContext (see below).
<BR><A href="/javadoc/org/mortbay/http/handler/SecurityHandler.html">SecurityHandler</A> - Provide BASIC and FORM authentication.
<BR><A href="/javadoc/org/mortbay/http/handler/HTAccessHandler.html">HTAccessHandler</A> - Provide apache .htaccess style security.
<BR><A href="/javadoc/org/mortbay/http/handler/NotFoundHandler.html">NotFoundHandler</A> - Handles unserviced requests.
<BR><A href="/javadoc/org/mortbay/http/handler/DumpHandler.html">DumpHandler</A> - A debugging tool that dumps the request and response headers. 
<BR><A href="/javadoc/org/mortbay/http/handler/ForwardHandler.html">ForwardHandler</A> - Forward a request to another URL
</UL>
Note that a ServletHandler is provided by the <A href="/javadoc/org/mortbay/jetty/servlet/package-summary.html">org.mortbay.jetty.servlet</A> package and is discussed in detail later in this tutorial.
<P>
HttpHandlers are tried within a context in the order they were added to the HandlerContext. The following code creates a 
context that checks authentication, then tries a servlet mapping before finally trying static content:
<PRE>
    HandlerContext context = server.addContext("/");
    context.add(new SecurityHandler());
    context.add(new ServletHandler());
    context.add(new ResourceHandler());
    context.add(new NotFoundHandler());
</PRE>
<P>

<FONT Size=+1><B>Resource Handler</B></FONT><BR>
The <a href="/javadoc/org/mortbay/http/handler/ResourceHandler.html">org.mortbay.http.handler.ResourceHandler</a> implementation of HttpHandler is used to server static content from a base directory or URL.   Its features include:<UL>
<LI>Support for GET, PUT, MOVE, DELETE, HEAD and OPTIONS methods.
<LI>LRU Memory cache.
<LI>Handling of IfModified headers.
<LI>HTTP/1.1 Range support for partial content serving.
<LI>Index/welcome files.
<LI>Generation of directory listings.
</UL>
The root directory or URL for serving static content is the ResourceBase of the HandlerContext.  Thus to 
server static content from the directory "./docroot/":
<PRE>
    HandlerContext context = server.addContext("myhost","/context/*");
    context.setResourceBase("./docroot/");
    context.add(new ResourceHandler());
</PRE>
As this is a frequent configuration option, a conveniance setServingResources method is provided that creates the ResourceHandler:
<PRE>
    HandlerContext context = server.addContext("myhost","/context/*");
    context.setResourceBase("./docroot/");
    context.setServingResources(true);
</PRE>
To configure the ResourceHandler in detail, it is best to construct it directly and add it to the context:
<PRE>
    ResourceHandler handler = new ResourceHandler();
    handler.setDirAllowed(true);
    handler.setPutAllowed(false);
    handler.setDelAllowed(false);
    handler.setAcceptRanges(true);
    handler.addIndexFile("index.html");
    handler.setMaxCachedFiles(200);
    handler.setMaxCachedFileSize(32000);
    context.addHandler(handler);
</PRE>
The same configuration can be done in XML:
<PRE>
    &lt;Call name="addHandler"&gt;
      &lt;Arg&gt;
        &lt;New class="org.mortbay.http.handler.ResourceHandler"&gt;
          &lt;Set name="dirAllowed"&gt;true&lt;/Set&gt;
          &lt;Set name="putAllowed"&gt;false&lt;/Set&gt;
          &lt;Set name="delAllowed"&gt;false&lt;/Set&gt;
          &lt;Set name="acceptRanges"&gt;true&lt;/Set&gt;
          &lt;Call name="addIndexFile"&gt;&lt;Arg&gt;index.html&lt;/Arg&gt;&lt;/Call&gt;
          &lt;Set name="maxCachedFiles"&gt;200&lt;/Set&gt;
          &lt;Set name="maxCachedFileSize"&gt;32000&lt;/Set&gt;
        &lt;/New&gt;
      &lt;/Arg&gt;
    &lt;/Call&gt;
</PRE>

<FONT size=-1>
<A href="overview.html">Back</A>
<A href="index.html">Index</A>
<A href="..">Exit</A>
<A href="Server.html">Next</A>
</FONT>
<P>