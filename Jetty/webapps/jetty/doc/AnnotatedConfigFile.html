<BR><B><FONT SIZE="+2"><A HREF="JettyConfiguration.html">JettyConfiguration</A> Example</FONT></B>       <HR>
We use etc/jetty.xml as an example:
<BR><BR>
This file configures:
<UL><UL><LI> A listener at port 8080 on all known interfaces
</LI><LI> The default web applicaton at /default/* context
</LI><LI> Dynamic servlet context at /servlet/*
</LI><LI> A context at / with serving files from ./docroot and
   the dump servlet at /dump.</LI></UL></UL><HR>
<B>Overview</B>
<BR><BR>
Jetty3 is configured using XML.  All Jetty config files should start
like this:
<CODE><PRE>
  &lt;?xml version="1.0"  encoding="ISO-8859-1"?>
  &lt;!DOCTYPE Configure SYSTEM "configure.dtd">
  &lt;Configure class="org.mortbay.http.HttpServer">
</PRE></CODE>
The top level tag allows configuration of an object of any type.  For
Jetty this is normally an object of type org.mortbay.http.HttpServer,
or some subtype.  The configuration interpreter checks that the object
is an instance of that class named by the "class" attribute.
<BR><BR><HR>
<B>Play by Play of jetty.xml</B>
<BR><BR>
As we go through the configuration, we will show Java-like pseudocode
corresponding to the actions requested by the config file.  The
expressions are real Java code, but the variable names are just to
help the reader, and do not mention the variable's type.
<BR><BR>
First it adds a Listener to the server object with:
<CODE><PRE>  &lt;Call name="addListener">
    &lt;Arg>
      &lt;New class="org.mortbay.http.SocketListener">
        &lt;Set name="Port">8080&lt;/Set>
        &lt;Set name="MinThreads">5&lt;/Set>
        &lt;Set name="MaxThreads">255&lt;/Set>
        &lt;Set name="MaxIdleTimeMs">50000&lt;/Set>
      &lt;/New>
    &lt;/Arg>
  &lt;/Call>
</PRE></CODE>
A Listener is a network interface object that accepts HTTP requests
for the server. SocketListeners accept normal requests, while
JsseListeners accept SSL requests.  The threading model of the server
is controlled by the listener parameters.
<BR><BR>
This adds a new listener of class org.mortbay.http.SocketListener to
the HttpServer as if by:
<CODE><PRE>  listener = server.addListener(new org.mortbay.http.SocketListener());</PRE></CODE>
The <Set> tags correspond to:
<CODE><PRE> listener.setPort(8080);
  listener.setMinThreads(5);
  listener.setMaxThreads(255);
  listener.setMaxIdleTimeMs(50000);</PRE></CODE><HR>
<B>Adding a Web Application</B>
<BR><BR>
A WebApplication&nbsp;<!-- widget ref --> is a bundled collection of resources, servlets
and configuration that can provide a unified WWW application.  It
is part of the 2.2 servlet standard.  The contents of the
application are configured by the web.xml deployment descriptor
within the application.  The configuration of the application
within Jetty requires on the context of the application to be
set.
<CODE><PRE>  &lt;Call name="addWebApplication">
    &lt;Arg>/default/*&lt;/Arg>
    &lt;Arg>&lt;SystemProperty name="user.dir"/>/webapps/default/&lt;/Arg>
  &lt;/Call></PRE></CODE>
These tags correspond to:
<CODE><PRE>  server.addWebApplication(
    "/default/*",
    System.getProperty("user.dir")+"/webapps/default"
  );</PRE></CODE><HR>
<B>Adding Servlets and Other Handlers</B>
<BR><BR>
Jetty groups Servlets and other handlers into Contexts.  A
Context is a grouping of server resources that share the same URL
path prefix, class path and resource base.  A Web application is
an example of a specific context.  Generic contexts may have
arbitrary request handlers added to them.  All contexts have a
path specification (frequently the default "*" [[??? -cp]]) and
an optional virtual host alias.
<BR><BR>
Request URL paths matching this pattern will be further matched
against the patterns for the Handlers and Servlets in the
Context.  The request's path will have to match the Context's
path, and the remainder of the request path will need to match
one of the path specs of the Servlet or Handler.
<BR><BR>
The following context allows servlet classes placed in the ./servlets
directory to be dynamically loaded.
<CODE><PRE>  &lt;Call name="addContext">
    &lt;Arg>/servlet/*&lt;/Arg>
    &lt;Set name="ClassPath">./servlets/&lt;/Set>
    &lt;Set name="ServingDynamicServlets">TRUE&lt;/Set>
  &lt;/Call></PRE></CODE>
As Java code, this is:
<CODE><PRE>  context = server.addContext("/servlet/*");
  context.setClassPath("./servlet/");
  context.setServingDynamicServlet(true);</PRE></CODE>
<BR><BR>
The second context is similar, but is set to serve resources.
<CODE><PRE>  &lt;Call name="addContext">
    &lt;Arg>/*&lt;/Arg>
    &lt;Set name="ResourceBase">./docroot/&lt;/Set>
    &lt;Set name="ServingResources">TRUE&lt;/Set></PRE></CODE>
Handlers are the objects that actually service the HTTP
requests. Examples of Handlers include ServletHandler,
ResourceHandler and NotFoundHandler.  Handlers are contained
within Contexts, which provide convenience methods for the common
handlers so that servlet and file serving may be concisely
configured for a context.
<BR><BR>
To this context we add the "Dump" servlet:
<CODE><PRE>    &lt;Call name="addServlet">
      &lt;Arg>Dump&lt;/Arg>
      &lt;Arg>/dump/*:/handler/Dump/*&lt;/Arg>
      &lt;Arg>org.mortbay.servlet.Dump&lt;/Arg>
    &lt;/Call></PRE></CODE>
In pseudo-Java, this is:
<CODE><PRE>    context.addServlet(
      "Dump",
      "/dump/*:/handler/Dump/*",
      "com.mortaby.Servlet.Dump"
    );</PRE></CODE>
The last <Call> adds a non-Servlet Handler to the context:
<CODE><PRE>    &lt;Call name="addHandler">
      &lt;Arg>&lt;New class="org.mortbay.http.handler.NotFoundHandler"/>&lt;/Arg>
    &lt;/Call></PRE></CODE>
As Java:
<CODE><PRE>    context.addHandler(new org.mortbay.http.handler.NotFoundHandler());</PRE></CODE><HR>
Return to <A HREF="JettyConfiguration.html">JettyConfiguration</A>.</BODY>
</HTML>
