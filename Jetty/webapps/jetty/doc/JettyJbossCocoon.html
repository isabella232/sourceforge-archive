<BR><B><FONT SIZE="+2">Jetty, JBoss and Cocoon</FONT></B>
<BR><BR>
Welcome to the New World...   The Full OpEn SoUrCe J2EE/XML Monty...
<PRE>
INSTRUCTIONS TO SETUP SETUP JBOSS WITH JETTY AND COCOON FROM SCRATCH

1. Download and unpack jboss/jetty from jboss.org website
(i'm using jboss pre-2.1 and jetty 3.0.2 all installed in
c:\jboss_jetty\ on a win2K machine using sun jdk 1.3.0)


2. Run out of the box
by going to /jboss/bin and running run_with_jetty.bat or .sh if in linux


3. Check that jboss/jetty loads up with no problems including
tomcat-test.ear
--&gt; test this by accessing http://localhost:8080/jboss/
--&gt; then run servlet,
--&gt; once this works, smile : ) you're almost there


4. Get cocoon, i'm using the 1.8.2 version precompiled


5. Copy cocoon related jars:
a) copy turbine-pool.jar, fop_0_15_0.jar, xalan_1_2_D02.jar, and w3c.jar
from cocoon-1.8.2/lib to jetty-3.0.2/lib

b)copy cocoon.jar from cocoon-1.8.2/bin to jetty-3.0.2/lib

courtesy of Fredrik Borgh:
FB&gt; Your cocoon jar-files can be placed in &lt;jetty&gt;/lib (this is where I keep
FB&gt; 'em) or you can leave them where they are, it's up to you :)!!

6. Setup xerces jar at the front of the classpath line
a) copy xerces_1_2.jar from cocoon-1.8.2/lib to jboss-PRE-2.1/lib

b) place xerces_1_2.jar ahead of all other in classpath
see below for my current jboss/bin/run.bat file


7. Set up Jetty to handle Cocoon
a) In Jetty/webapps directory, I created xml directory or (pick any name you
want)

b) copy samples directory from cocoon/samples to Jetty/webapps/xml/

c) create WEB-INF directory in Jetty/webapps/xml/

d) copy cocoon.properties from cocoon/conf to Jetty/webapps/xml/WEB-INF

e) copy Jetty/webapps/default/WEB-INF/web.xml to
Jetty-3.0.2/webapps/xml/WEB-INF
and replace contents with

&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN"
    "http://java.sun.com/j2ee/dtds/web-app_2.2.dtd"&gt;

&lt;web-app&gt;
&lt;servlet&gt;
&lt;servlet-name&gt;cocoon&lt;/servlet-name&gt;
&lt;servlet-class&gt;org.apache.cocoon.Cocoon&lt;/servlet-class&gt;
&lt;init-param&gt;
&lt;param-name&gt;properties&lt;/param-name&gt;
&lt;param-value&gt;./WEB-INF/cocoon.properties&lt;/param-value&gt;
&lt;/init-param&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
&lt;servlet-name&gt;cocoon&lt;/servlet-name&gt;
&lt;url-pattern&gt;*.xml&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;/web-app&gt;


f) update jboss-PRE-2.1/conf/jetty/jetty.xml to include

  &lt;Call name="addWebApplication"&gt;
&lt;Arg&gt;/xml/*&lt;/Arg&gt;
&lt;Arg&gt;&lt;SystemProperty name="jetty.home"
default="."/&gt;/webapps/xml/&lt;/Arg&gt;
&lt;Arg&gt;&lt;SystemProperty name="jetty.home"
default="."/&gt;/etc/webdefault.xml/&lt;/Arg&gt;
&lt;/Call&gt;


9. Finally, replace org.apache.cocoon.Utils in cocoon.jar for reasons
described below,
coutesy of Fredrik Borgh:

FB&gt; The problem is that the new version of Cocoon (1.8.2) seems to have an
error
FB&gt; in org.apache.cocoon.Utils. I've corrected the error and recompiled the
FB&gt; class. It's included in this mail. All you have to do is to replace the
FB&gt; existing org.apache.cocoon.Utils in cocoon.jar with this one. Please
note
FB&gt; that this is just my own fix, hopefully they'll correct it in a new
release.


10. Go back to command line/shell and call
jboss-PRE-2.1/lib/run_with_jetty.bat

11. Once everything starts up perfectly
go to http://localhost:8080/xml/Cocoon.xml and run the samples at
      http://localhost:8080/xmlsamples/index.xml

if you see this "virtual page" and the samples --&gt; party!!!!! :))

and welcome to brave new world of The Full OpEn SoUrCe J2EE/XML Monty...

and give a small thanks to Marc, Rickard and all the rest of the Jboss
gurus,
Stefano Mazzocchi, Robin Green, Donald Ball and all the rest of the
Cocoon wizards, and Greg Wilkins, Fredrik Borgh and all the gurus and
wizards of Jetty!!!




EXTRA CONFIGURATION FILE INFO

**************jboss/bin/run.bat******************************

@echo off
@if not "%ECHO%" == ""  echo %ECHO%
@if "%OS%" == "Windows_NT"  setlocal

set CLASSPATH=%CLASSPATH%;..\lib\xerces_1_2.jar
set CLASSPATH=%CLASSPATH%;run.jar

REM Add all login modules for JAAS-based security
REM and all libraries that are used by them here
set
CLASSPATH=%CLASSPATH%;..\lib\jdbc2_0-stdext.jar;..\lib\jboss-jaas.jar;\tools
.jar
REM ;..\lib\xalan_1_2_D02.jar

echo Using CLASSPATH: %CLASSPATH%
java -classpath "%CLASSPATH%" org.jboss.Main %1 %2 %3 %4 %5 %6 %7 %8 %9

pause


**************************************************************



************Jetty-3.0.2/webapps/xml/WEB-INF/web.xml*************
&lt;!--
     This is the web-app configurations that allow Cocoon to work under
     Jetty. Please, follow the installation section of the
     documentation (right! ;-)wink-wink) for more information
	about installing Cocoon on Jetty
--&gt;

&lt;!DOCTYPE web-app
    PUBLIC "-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN"
    "http://java.sun.com/j2ee/dtds/web-app_2.2.dtd"&gt;

&lt;web-app&gt;
&lt;servlet&gt;
&lt;servlet-name&gt;cocoon&lt;/servlet-name&gt;
&lt;servlet-class&gt;org.apache.cocoon.Cocoon&lt;/servlet-class&gt;
&lt;init-param&gt;
&lt;param-name&gt;properties&lt;/param-name&gt;
&lt;param-value&gt;./WEB-INF/cocoon.properties&lt;/param-value&gt;
&lt;/init-param&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
&lt;servlet-name&gt;cocoon&lt;/servlet-name&gt;
&lt;url-pattern&gt;*.xml&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;/web-app&gt;

*********************************************************************




**************jboss-PRE-2.1/conf/jetty/jetty.xml*********************

&lt;?xml version="1.0"  encoding="ISO-8859-1"?&gt;
&lt;!DOCTYPE Configure PUBLIC
 "-//Mort Bay Consulting//DTD Configure 1.0//EN"
 "http://jetty.mortbay.org/configure_1_0.dtd"&gt;

&lt;!--
This is a Jetty HTTP server configuration file.  This configuration
uses the generic org.mortbay.util.XmlConfiguration class to call
the normal org.mortbay.http.HttpServer configuration API from
within an XML script.

The format of this file is described in the configure.dtd file.

The API that can be called by this file is described in the
Javadoc for Jetty.

The following concepts must be understood when configuring
a server:

Listener: is a network interface object that
accepts HTTP requests for the server. SocketListeners accept
normal requests, while JsseListeners accept SSL requests.
The threading model of the server is controlled by the
listener parameters.

WebApplication: is a bundled collection of resources,
servlets and configuration that can provide a unified
WWW application.  It is part of the 2.2 servlet standard.
The contents of the application are configured by the
web.xml deployment descriptor within the application.
The configuration of the application within Jetty requires
on the context of the application to be set.

Context: is a grouping of server resources that share
the same URL path prefix, class path and resource base.
A Web application is an example of a specific context.
Generic contexts may have arbitrary request handlers
added to them.  All contexts have a path specification
(frequently the default "/") and an option virtual
host alias.

Handler:  Handlers are the objects that actually
service the HTTP requests. Examples of Handlers include
ServletHandler, ResourceHandler and NotFoundHandler.
Handlers are contained within Contexts, which provide
conveniance methods for the common handlers so
that servlet and file serving may be configured for
a context without explicit creation of a Handler.


This file configures the demo server and is equivalent
to the org.mortbay.jetty.Demo class.

$ID: $
--&gt;

&lt;Configure class="org.mortbay.http.HttpServer"&gt;
&lt;Call name="addListener"&gt;
&lt;Arg&gt;
&lt;New class="org.mortbay.http.SocketListener"&gt;
&lt;Set name="Port"&gt;8080&lt;/Set&gt;
&lt;Set name="MinThreads"&gt;5&lt;/Set&gt;
&lt;Set name="MaxThreads"&gt;255&lt;/Set&gt;
&lt;Set name="MaxIdleTimeMs"&gt;60000&lt;/Set&gt;
&lt;Set name="MaxReadTimeMs"&gt;60000&lt;/Set&gt;
&lt;/New&gt;
&lt;/Arg&gt;
&lt;/Call&gt;

&lt;!--  Uncomment this to add an SSL listener.
  &lt;Call name="addListener"&gt;
&lt;Arg&gt;
&lt;New class="org.mortbay.http.SunJsseListener"&gt;
&lt;Set name="Port"&gt;8443&lt;/Set&gt;
&lt;Set name="MinThreads"&gt;5&lt;/Set&gt;
&lt;Set name="MaxThreads"&gt;255&lt;/Set&gt;
&lt;Set name="MaxIdleTimeMs"&gt;50000&lt;/Set&gt;
&lt;Set name="Keystore"&gt;etc/demokeystore&lt;/Set&gt;
&lt;Set name="Password"&gt;OBF:1vny1zlo1x8e1vnw1vn61x8g1zlu1vn4&lt;/Set&gt;
&lt;Set name="KeyPassword"&gt;OBF:1u2u1wml1z7s1z7a1wnl1u2g&lt;/Set&gt;
&lt;/New&gt;
&lt;/Arg&gt;
&lt;/Call&gt;
--&gt;

&lt;Call name="addWebApplication"&gt;
&lt;Arg&gt;/jetty/*&lt;/Arg&gt;
&lt;Arg&gt;&lt;SystemProperty name="jetty.home"/&gt;/webapps/jetty.war&lt;/Arg&gt;
&lt;Arg&gt;&lt;SystemProperty name="jetty.home"/&gt;/etc/webdefault.xml/&lt;/Arg&gt;
&lt;/Call&gt;

&lt;Call name="addContext"&gt;
&lt;Arg&gt;/demo/*&lt;/Arg&gt;
&lt;Set name="ResourceBase"&gt;&lt;SystemProperty
name="jetty.home"/&gt;/docroot/&lt;/Set&gt;
&lt;Call name="addServlet"&gt;
&lt;Arg&gt;Dump&lt;/Arg&gt;
&lt;Arg&gt;/dump/*,*.DUMP&lt;/Arg&gt;
&lt;Arg&gt;org.mortbay.servlet.Dump&lt;/Arg&gt;
&lt;/Call&gt;
&lt;Call name="addServlet"&gt;
&lt;Arg&gt;Session&lt;/Arg&gt;
&lt;Arg&gt;/session&lt;/Arg&gt;
&lt;Arg&gt;org.mortbay.servlet.SessionDump&lt;/Arg&gt;
&lt;/Call&gt;
&lt;Call name="addServlet"&gt;
&lt;Arg&gt;Dispatch&lt;/Arg&gt;
&lt;Arg&gt;/Dispatch/*&lt;/Arg&gt;
&lt;Arg&gt;org.mortbay.servlet.RequestDispatchTest&lt;/Arg&gt;
&lt;/Call&gt;
&lt;Call name="addServlet"&gt;
&lt;Arg&gt;JSP&lt;/Arg&gt;
&lt;Arg&gt;*.jsp&lt;/Arg&gt;
&lt;Arg&gt;org.apache.jasper.servlet.JspServlet&lt;/Arg&gt;
&lt;/Call&gt;
&lt;Set name="ServingResources"&gt;TRUE&lt;/Set&gt;
&lt;Call name="addHandler"&gt;
&lt;Arg&gt;&lt;New class="org.mortbay.http.handler.DumpHandler"/&gt;&lt;/Arg&gt;
&lt;/Call&gt;
&lt;Set name="HttpServerAccess"&gt;TRUE&lt;/Set&gt;
&lt;/Call&gt;

&lt;Call name="addContext"&gt;
&lt;Arg&gt;/javadoc/*&lt;/Arg&gt;
&lt;Set name="ResourceBase"&gt;&lt;SystemProperty
name="jetty.home"/&gt;/javadoc/&lt;/Set&gt;
&lt;Set name="ServingResources"&gt;TRUE&lt;/Set&gt;
&lt;/Call&gt;

&lt;Call name="addContext"&gt;
&lt;Arg&gt;/cgi-bin/*&lt;/Arg&gt;
&lt;Set name="ResourceBase"&gt;&lt;SystemProperty
name="jetty.home"/&gt;/cgi-bin&lt;/Set&gt;
&lt;Call name="addServlet"&gt;
&lt;Arg&gt;Common Gateway Interface&lt;/Arg&gt;
&lt;Arg&gt;/&lt;/Arg&gt;
&lt;Arg&gt;org.mortbay.servlet.CGI&lt;/Arg&gt;
&lt;Put name="Path"&gt;/bin:/usr/bin:/usr/local/bin&lt;/Put&gt;
&lt;/Call&gt;
&lt;/Call&gt;

&lt;Call name="addContext"&gt;
&lt;Arg&gt;/&lt;/Arg&gt;
&lt;Set name="DynamicServletPathSpec"&gt;/servlet/*&lt;/Set&gt;
&lt;Call name="addServlet"&gt;
&lt;Arg&gt;Forward&lt;/Arg&gt;
&lt;Arg&gt;/&lt;/Arg&gt;
&lt;Arg&gt;org.mortbay.servlet.Forward&lt;/Arg&gt;
&lt;Put name="/"&gt;/jetty/index.html&lt;/Put&gt;
&lt;/Call&gt;
&lt;Call name="addHandler"&gt;
&lt;Arg&gt;&lt;New class="org.mortbay.http.handler.NotFoundHandler"/&gt;&lt;/Arg&gt;
&lt;/Call&gt;
&lt;/Call&gt;

&lt;Call name="addRealm"&gt;
&lt;Arg&gt;
&lt;New class="org.mortbay.http.HashUserRealm"&gt;
&lt;Arg&gt;Jetty Demo Realm&lt;/Arg&gt;
&lt;Arg&gt;&lt;SystemProperty
name="jetty.home"/&gt;/etc/demoRealm.properties&lt;/Arg&gt;
&lt;/New&gt;
&lt;/Arg&gt;
&lt;/Call&gt;

&lt;Set name="LogSink"&gt;
&lt;New class="org.mortbay.util.WriterLogSink"&gt;
&lt;Arg&gt;&lt;SystemProperty name="jetty.home"
default="./logs"/&gt;/yyyy_mm_dd.request.log&lt;/Arg&gt;
&lt;Set name="RetainDays"&gt;90&lt;/Set&gt;
&lt;Set name="Append"&gt;true&lt;/Set&gt;
&lt;/New&gt;
&lt;/Set&gt;

&lt;!--  add below to run cocoon --&gt;

&lt;Call name="addWebApplication"&gt;
&lt;Arg&gt;/xml/*&lt;/Arg&gt;
&lt;Arg&gt;&lt;SystemProperty name="jetty.home"
default="."/&gt;/webapps/xml/&lt;/Arg&gt;
&lt;Arg&gt;&lt;SystemProperty name="jetty.home"
default="."/&gt;/etc/webdefault.xml/&lt;/Arg&gt;
&lt;/Call&gt;

&lt;/Configure&gt;
