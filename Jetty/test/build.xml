<!--
========================================================================
 Copyright (c) 1999 Mort Bay Consulting (Australia) Pty. Ltd.
 $Id$
========================================================================
 This build file specifies how to test Jetty using ANT, the
 build tool from the Apache/Jakarta project.
  <http://jakarta.apache.org/ant/index.html>
========================================================================

The default target is "test", which will build all tests and run them.

Other targets:

  clean         - Remove all generated files.
  prepare       - Set up build directory structure.

!!NOTE: To run these tests you must have previously downloaded and installed 
the Ant optional tasks from:

   http://jakarta.apache.org/ant
-->
<project name="Jetty HTTP Server Tests" default="test" basedir="..">
  <property environment="env"/>
  <property name="src"            value="${basedir}/src" />
  <property name="etc"            value="${basedir}/etc" />
  <property name="lib"            value="${basedir}/lib"/>
  <property name="classes"        value="${basedir}/classes"/>
  <property name="javadoc"        value="${basedir}/javadoc"/>
  <property name="logs"           value="${basedir}/logs"/>
  <property name="webapps"        value="${basedir}/webapps"/>
  <property name="webappsrc"      value="${basedir}/webappsrc"/>
  <property name="test"           value="${basedir}/test"/>
  <property name="test.lib"       value="${test}/lib"/>
  <property name="test.src"       value="${test}/src"/>
  <property name="test.classes"   value="${test}/classes"/>
  <property name="build.compiler" value="jikes"/>
  <!-- property name="build.compiler" value="classic"/ -->
  <!-- property name="build.compiler" value="modern" / -->

  <property name="javac.debug"             value="on" />
  <property name="javac.optimize"          value="off" />
  <property name="javac.deprecation"       value="off" />

  <property name="jetty.home"             value="${basedir}" />
  <property name="jetty.webapp"           value="${webapps}/jetty"/>
  <property name="jetty.war"              value="${webapps}/jetty.war"/>
  <property name="jetty.webapp.webinf"    value="${jetty.webapp}/WEB-INF"/>
  <property name="jetty.webapp.classes"   value="${jetty.webapp.webinf}/classes"/>

  <property name="jetty.jar"      value="${lib}/org.mortbay.jetty.jar"/>
  <property name="mini.http.jar"  value="${basedir}/org.mortbay.http.jar"/>
  <property name="servlet.jar"    value="${lib}/javax.servlet.jar"/>
  <property name="jasper.jar"     value="${lib}/org.apache.jasper.jar"/>
  <property name="jaxp.jar"       value="${lib}/javax.xml.jaxp.jar"/>
  <property name="xml.jar"        value="${lib}/org.apache.crimson.jar"/>
  <property name="jsse.jar"       value="${lib}/com.sun.net.ssl.jar"/>
  <property name="junit.jar"      value="${test.lib}/junit-3.7.jar"/>

  <path id="classpath">
    <pathelement path="${jetty.jar}" />
    <pathelement path="${jasper.jar}" />
    <pathelement path="${servlet.jar}" />
    <pathelement path="${jsse.jar}" />
    <pathelement path="${jaxp.jar}" />
    <pathelement path="${xml.jar}" />
  </path>

  <!-- ==================================================================== -->
  <target name="prepare">
    <mkdir dir="${test.classes}" />
  </target>

  <!-- ==================================================================== -->
  <target name="tidy">
    <delete dir="${test.classes}" quiet="true"/>
  </target>


  <!-- ==================================================================== -->
  <target name="clean" depends="tidy">
  </target>


  <!-- ==================================================================== -->
  <target name="compile" depends="prepare">
    <echo message="${java.class.path}" />
    <javac srcdir="${test.src}"
           destdir="${test.classes}"
           debug="true"
           optimize="fale"
           deprecation="${javac.deprecation}"
           >
       <classpath>
         <path refid="classpath" />
         <pathelement path="${junit.jar}" />     
       </classpath>
       <include name="**/*.java"/>
    </javac>
  </target>

  <!-- ==================================================================== -->
  <target name="test" depends="compile">
    <junit fork="no" haltonerror="yes" haltonfailure="yes" >
      <formatter type="brief" usefile="false" />                  
      <classpath> 
         <path refid="classpath" />
         <pathelement path="${junit.jar}" />     
         <pathelement path="${test.classes}" />     
      </classpath>        
      <test name="org.mortbay.util.JUnitTestHarness"  />
    </junit>
  </target>


</project>







